synch sw1 (NETIN, __unblock__ | NETOUT, BYPASS, rewire, __output__)
{
  start {
    on:
      NETIN.(__ffp__, __rfp__) & [__ffp__ && !__rfp__] {
        send this => output;
      }

      NETIN.(__ffp__, __rfp__) & [__ffp__ && __rfp__] {
        send this => output, (rewire: [1]) => rewire;
        goto bypass;
      }

      NETIN.(__ffp__, __rfp__) & [!__ffp__ && __rfp__] {
        send this => NETOUT, (rewire: [1]) => rewire;
        goto bypass;
      }

    elseon:
      NETIN.(__ffp__) & [__ffp__] {
        send this => output;
      }

      NETIN.(__rfp__) & [__rfp__] {
        send this => NETOUT, (rewire: [1]) => rewire;
        goto bypass;
      }

      NETIN.else {
        send this => NETOUT;
      }
  }

  bypass {
    on:
      NETIN {
        send this => BYPASS;
      }
  }

  block {
    unblock {
      goto start;
    }
  }
}
